<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Charm Collector — Devlog</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Rajdhani:wght@400;600;700&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --bg:       #060a14;
    --panel:    #0b1120;
    --border:   #1a2a4a;
    --gold:     #f0a030;
    --gold2:    #ffd080;
    --blue:     #3a8fff;
    --blue2:    #7ab8ff;
    --green:    #30d080;
    --red:      #ff4a4a;
    --orange:   #ff8c3a;
    --muted:    #4a6080;
    --text:     #c8d8f0;
    --dim:      #6080a0;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'Rajdhani', sans-serif;
    font-size: 16px;
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.08) 2px,
      rgba(0,0,0,0.08) 4px
    );
    pointer-events: none;
    z-index: 999;
  }

  .container {
    max-width: 920px;
    margin: 0 auto;
    padding: 40px 24px 80px;
  }

  /* ── Header ── */
  .header {
    text-align: center;
    margin-bottom: 56px;
    position: relative;
  }

  .header::after {
    content: '';
    display: block;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--gold), var(--blue), transparent);
    margin-top: 24px;
  }

  .game-title {
    font-family: 'Orbitron', sans-serif;
    font-size: clamp(20px, 5vw, 38px);
    font-weight: 900;
    color: var(--gold);
    text-shadow: 0 0 30px rgba(240,160,48,0.5), 0 0 60px rgba(240,160,48,0.2);
    letter-spacing: 4px;
    text-transform: uppercase;
    animation: flicker 8s infinite;
  }

  @keyframes flicker {
    0%,96%,100% { opacity: 1; }
    97% { opacity: 0.82; }
    98% { opacity: 1; }
    99% { opacity: 0.88; }
  }

  .sub {
    font-family: 'Share Tech Mono', monospace;
    font-size: 13px;
    color: var(--dim);
    letter-spacing: 3px;
    margin-top: 8px;
    text-transform: uppercase;
  }

  .date-badge {
    display: inline-block;
    margin-top: 14px;
    padding: 4px 16px;
    border: 1px solid var(--blue);
    color: var(--blue2);
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    letter-spacing: 2px;
    background: rgba(58,143,255,0.06);
  }

  /* ── Stats bar ── */
  .stats-bar {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 12px;
    margin-bottom: 48px;
  }

  .stat {
    background: var(--panel);
    border: 1px solid var(--border);
    border-top: 2px solid var(--gold);
    padding: 14px 18px;
    position: relative;
    overflow: hidden;
  }

  .stat::before {
    content: '';
    position: absolute;
    top: 0; right: 0;
    width: 40px; height: 40px;
    background: radial-gradient(circle at top right, rgba(240,160,48,0.08), transparent);
  }

  .stat-label {
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    color: var(--dim);
    letter-spacing: 2px;
    text-transform: uppercase;
  }

  .stat-value {
    font-family: 'Orbitron', sans-serif;
    font-size: 22px;
    font-weight: 700;
    color: var(--gold2);
    margin-top: 2px;
  }

  /* ── Section ── */
  .section { margin-bottom: 44px; }

  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
  }

  .section-header h2 {
    font-family: 'Orbitron', sans-serif;
    font-size: 13px;
    font-weight: 700;
    color: var(--blue2);
    letter-spacing: 3px;
    text-transform: uppercase;
    white-space: nowrap;
  }

  .section-header::after {
    content: '';
    flex: 1;
    height: 1px;
    background: linear-gradient(90deg, var(--border), transparent);
  }

  /* ── Entry cards ── */
  .entry {
    background: var(--panel);
    border: 1px solid var(--border);
    border-left: 3px solid var(--blue);
    margin-bottom: 12px;
    padding: 16px 20px;
    position: relative;
    transition: border-color 0.2s, background 0.2s;
    animation: slideIn 0.4s ease both;
  }

  .entry:hover { border-left-color: var(--gold); background: #0d1525; }

  @keyframes slideIn {
    from { opacity: 0; transform: translateX(-12px); }
    to   { opacity: 1; transform: translateX(0); }
  }

  .entry.fix     { border-left-color: var(--green); }
  .entry.bug     { border-left-color: var(--red); }
  .entry.improve { border-left-color: var(--blue); }
  .entry.feature { border-left-color: var(--gold); }
  .entry.pending { border-left-color: var(--orange); }

  .entry-tag {
    display: inline-block;
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    padding: 2px 8px;
    letter-spacing: 1px;
    text-transform: uppercase;
    margin-bottom: 8px;
    border: 1px solid currentColor;
  }

  .entry.fix     .entry-tag { color: var(--green);  background: rgba(48,208,128,0.07); }
  .entry.bug     .entry-tag { color: var(--red);    background: rgba(255,74,74,0.07); }
  .entry.improve .entry-tag { color: var(--blue2);  background: rgba(58,143,255,0.07); }
  .entry.feature .entry-tag { color: var(--gold);   background: rgba(240,160,48,0.07); }
  .entry.pending .entry-tag { color: var(--orange); background: rgba(255,140,58,0.07); }

  .entry-title {
    font-size: 17px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 4px;
    line-height: 1.3;
  }

  .entry-desc {
    font-size: 14px;
    color: var(--dim);
    line-height: 1.55;
  }

  .entry-desc code {
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    color: var(--gold2);
    background: rgba(240,160,48,0.08);
    padding: 1px 5px;
    border-radius: 2px;
  }

  /* ── Known issues ── */
  .known {
    background: rgba(255,74,74,0.04);
    border: 1px solid rgba(255,74,74,0.2);
    border-left: 3px solid var(--red);
    padding: 16px 20px;
    margin-bottom: 10px;
  }

  .known-title {
    font-size: 15px;
    font-weight: 700;
    color: #ff8080;
    margin-bottom: 3px;
  }

  .known-desc {
    font-size: 13px;
    color: var(--dim);
    line-height: 1.5;
  }

  .known-desc code {
    font-family: 'Share Tech Mono', monospace;
    font-size: 12px;
    color: #ff9090;
    background: rgba(255,74,74,0.08);
    padding: 1px 5px;
  }

  /* ── Footer ── */
  .footer {
    margin-top: 64px;
    text-align: center;
    font-family: 'Share Tech Mono', monospace;
    font-size: 11px;
    color: var(--muted);
    letter-spacing: 2px;
    border-top: 1px solid var(--border);
    padding-top: 24px;
  }

  .pulse {
    display: inline-block;
    width: 7px; height: 7px;
    background: var(--green);
    border-radius: 50%;
    margin-right: 8px;
    animation: pulse 2s infinite;
    vertical-align: middle;
  }

  @keyframes pulse {
    0%,100% { opacity: 1; box-shadow: 0 0 0 0 rgba(48,208,128,0.4); }
    50%      { opacity: 0.7; box-shadow: 0 0 0 5px rgba(48,208,128,0); }
  }
</style>
</head>
<body>
<div class="container">

  <div class="header">
    <div class="game-title">Charm Collector</div>
    <div class="sub">BotWithUs Script — Development Log</div>
    <div class="date-badge">Session 1 — Feb 25, 2026 &nbsp;·&nbsp; Session 2 — Feb 27, 2026</div>
  </div>

  <div class="stats-bar">
    <div class="stat">
      <div class="stat-label">Features Added</div>
      <div class="stat-value">19</div>
    </div>
    <div class="stat">
      <div class="stat-label">Improvements</div>
      <div class="stat-value">9</div>
    </div>
    <div class="stat">
      <div class="stat-label">Bugs Fixed</div>
      <div class="stat-value" style="color: var(--green);">8</div>
    </div>
    <div class="stat">
      <div class="stat-label">API Version</div>
      <div class="stat-value" style="font-size:15px; margin-top:4px;">1.0.8</div>
    </div>
    <div class="stat">
      <div class="stat-label">Status</div>
      <div class="stat-value" style="font-size:13px; color: var(--green); margin-top:6px;"><span class="pulse"></span>IN DEV</div>
    </div>
  </div>


  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!--  FEATURES ADDED                                                         -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <div class="section">
    <div class="section-header"><h2>Features Added</h2></div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Auto Eat</div>
      <div class="entry-desc">
        Eats food from the backpack when HP drops below a configurable percentage threshold. 
        Food is identified entirely by name — no item IDs required. 
        The food name and eat-below threshold are both configurable from the UI. 
        Eating is skipped during the overload damage window to prevent wasted food ticks.
        Tracks total food eaten per session.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Charming Potion Maintenance</div>
      <div class="entry-desc">
        Automatically maintains the Charming potion buff (6-minute duration). 
        Searches the backpack for doses (4) down to (1) by name and drinks the highest available. 
        Re-drinks with 90 seconds remaining on the buff so there is no gap in coverage. 
        Tracks total potions consumed per session and shows a live countdown in the UI.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Overload Maintenance</div>
      <div class="entry-desc">
        Maintains the Overload buff (6-minute duration) with support for all four variants: 
        <code>Super overload salve</code>, <code>Super overload</code>, <code>Overload (salve)</code>, and <code>Overload</code>, 
        each searched doses (4) to (1) in priority order. 
        After drinking, a 5-second damage window is observed — auto-eat is suppressed during this 
        period to prevent food from being wasted on the intentional HP drain ticks.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Auto Loot — Loot All &amp; Loot Custom modes</div>
      <div class="entry-desc">
        Fires a loot action on a randomised timer (45 seconds to 2 minutes) with human-like delays. 
        Supports two modes selectable via radio button: <code>Loot All</code> and <code>Loot Custom</code>, 
        each using the correct component action ID for the loot interface (id <code>1490</code>). 
        If the interface is closed, the nearest ground item is clicked via 
        <code>GroundItemAction.GROUND_ITEM1</code> to reopen it before looting. 
        Charm and coin gains are tracked via a pre/post backpack snapshot on every loot cycle.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Bury Bones</div>
      <div class="entry-desc">
        Automatically buries any bones present in the backpack after each loot cycle. 
        Uses <code>InventoryItemQuery.option("Bury")</code> to find all buriable items — 
        zero hardcoded names or IDs, so every bone type in the game is supported automatically including 
        future additions. Buries one at a time with a 1.7–2.1 second wait between each for the bury animation. 
        Tracks total bones buried per session.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Aggro Rotation — AFK Location Presets</div>
      <div class="entry-desc">
        Detects aggro loss using four independent signals: <code>inCombat()</code>, 
        <code>getHitmarks()</code> (being hit this tick), <code>hasTarget()</code> (player targeting something), 
        and <code>NpcQuery.interactId(playerId)</code> (any NPC locked onto the player). 
        After a configurable grace period of no-combat signals, the script walks to the next spot in 
        the selected preset using <code>WalkAction.WALK</code> DoAction calls. 
        Arrival is confirmed by polling <code>Distance.between()</code> until within 3 tiles. 
        Preset spots are defined with coordinates and the correct <code>param1</code> values matching 
        the game's original DoAction format. The Hellhounds (GWD) rotation is included as the first preset.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Per-feature Checkbox Toggles</div>
      <div class="entry-desc">
        Every feature in the script is independently toggleable from the ImGui UI panel via checkbox. 
        Disabling a feature collapses its sub-settings in the UI to keep the panel clean. 
        Features covered: Auto Eat, Charming Potion, Overload, Auto Loot, Bury Bones, Aggro Rotation. 
        Each section shows relevant live stats and status only when enabled.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Session Statistics Panel</div>
      <div class="entry-desc">
        Tracks and displays live session stats: total charms looted, charms/hr, coins looted, coins/hr, 
        food eaten, charming potions drank, overloads drank, and bones buried. 
        All rates are computed from the session start time. Stats reset on each Start press.
      </div>
    </div>

  </div>



    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">BWU-Styled ImGui UI — Sidebar Navigation</div>
      <div class="entry-desc">
        Replaced the flat ImGui panel with a full BWU-themed window matching the BotWithUs design language.
        Uses <code>BwuImGuiStyle.applyBwuTheme()</code> with a dark blue transparent background
        (<code>WindowBg 0.04 / 0.08 / 0.22 / 0.82</code>), <code>NoTitleBar</code> window flags,
        and <code>BwuImGuiStyle.gradientButton()</code> for Start/Stop.
        A three-tab sidebar (Settings / Statistics / Console) handles navigation,
        with active tabs glowing blue and inactive tabs transparent.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">UI Split — CharmCollectorUI.java Separate File</div>
      <div class="entry-desc">
        The <code>CharmCollectorUI</code> inner class was extracted into its own top-level file
        in the same package. All fields accessed by the UI were changed from <code>private</code>
        to package-private. Constants referenced by the UI (<code>LOOT_ALL_INTERFACE</code>,
        <code>CHARM_POTION_DURATION_MS</code>, <code>OVERLOAD_DURATION_MS</code>,
        <code>AFK_PRESETS</code>, <code>AfkLocation</code>) were similarly made package-private.
        The UI holds a <code>script</code> reference and a <code>ScriptConsole</code> reference
        for the live console log panel.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Console Panel with Feature Descriptions</div>
      <div class="entry-desc">
        The Console tab now shows static descriptive text for every feature above the live log output,
        explaining what each module does and what to expect in the log.
        Live output is rendered in a scrollable child window with <code>SetScrollHereY(1f)</code>
        auto-scroll and capped at the last 200 lines.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">Loot Interface ID Corrected — 1490 → 1486</div>
      <div class="entry-desc">
        The loot interface was hardcoded as <code>1490</code> but the actual interface ID confirmed
        in-game is <code>1486</code>. The old value caused <code>Interfaces.isOpen()</code> to always
        return false, so the script never fired the loot action — instead looping forever through the
        reopen path. Fixed to <code>1486</code>.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">Loot Reopen — Now Targets Gold Charm First</div>
      <div class="entry-desc">
        The ground item reopen logic previously clicked the nearest <em>any</em> item,
        which could land on a player-dropped item or unrelated object.
        Rewritten to search in priority order: <code>Gold charm</code> first (drops constantly at Hellhounds),
        then any other charm type, then nearest anything as a last resort.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">ImGui API Correctness — SliderInt / InputText / RadioButton</div>
      <div class="entry-desc">
        Three widget calls were wrong after inspecting the embedded Javadoc in <code>botwithus-api-1.0.8.jar</code>.
        <code>SliderInt(String,int[],int,int)</code> does not exist — correct method is
        <code>Slider(String, int, int, int, int)</code> (flags as fifth arg).
        <code>InputText</code> takes <code>(String label, String text)</code> and returns a <code>String</code> —
        not a <code>String[]</code> buffer.
        <code>RadioButton(String, boolean)</code> does not exist — replaced with
        <code>Combo(String, int, String...)</code> returning the selected index.
      </div>
    </div>

  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!--  IMPROVEMENTS                                                            -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <div class="section">
    <div class="section-header"><h2>Improvements</h2></div>

    <div class="entry improve">
      <div class="entry-tag">Improve</div>
      <div class="entry-title">Human-like Delays Throughout</div>
      <div class="entry-desc">
        All actions use randomised delays via the API's built-in <code>RandomGenerator.nextInt(min, max)</code> 
        rather than fixed sleeps or <code>java.util.Random</code>. Pre-action pauses, post-eat delays, 
        post-drink delays, loot cycle intervals, pre-walk pauses, and post-arrival waits all 
        use distinct randomised ranges to avoid timing fingerprinting.
      </div>
    </div>

    <div class="entry improve">
      <div class="entry-tag">Improve</div>
      <div class="entry-title">Walk Jitter + Click Limit on Aggro Rotation</div>
      <div class="entry-desc">
        Walk actions apply ±1 tile random jitter to the target coordinates so the exact same 
        tile is never clicked twice. Each rotation sends only 1–3 walk clicks (randomly chosen) 
        with a short gap between each rather than spamming the action repeatedly. 
        The script then waits for actual arrival using distance polling rather than a fixed timer.
      </div>
    </div>

    <div class="entry improve">
      <div class="entry-tag">Improve</div>
      <div class="entry-title">Not-Retaliating Detection</div>
      <div class="entry-desc">
        The aggro detection layer distinguishes between "being attacked and fighting back" 
        vs "being attacked but not retaliating." If an NPC is targeting the player but the 
        player has no target and is not in combat, a warning is logged to the console: 
        <code>Being attacked but not retaliating — check auto-retaliate is ON.</code> 
        Aggro is still treated as active in both cases so the rotation does not fire.
      </div>
    </div>

    <div class="entry improve">
      <div class="entry-tag">Improve</div>
      <div class="entry-title">API Correctness Pass — Full JAR Inspection</div>
      <div class="entry-desc">
        The BotWithUs API JAR (v1.0.8) was fully inspected to verify every call used in the script. 
        Corrected: HP reading from <code>LocalPlayer.getCurrentHealth()</code> and <code>getMaximumHealth()</code> 
        (not a static Client method); food/potion interactions via <code>Backpack.interact(name, option)</code>; 
        ground item interaction via <code>GroundItemAction</code> enum; nearest item via 
        <code>EntityResultSet.nearest()</code>; random delays via <code>RandomGenerator</code>; 
        and <code>Client.setAntiAFK()</code> on start/stop.
      </div>
    </div>

  </div>



    <div class="entry improve">
      <div class="entry-tag">Improve</div>
      <div class="entry-title">Settings Panel Reorganised</div>
      <div class="entry-desc">
        Settings tab restructured into three clear sections.
        <strong>Settings</strong> groups Charming Potion, Overload, and Bury Bones together.
        <strong>Loot &amp; Aggro</strong> combines Auto Loot (with mode selector) and Aggro Rotation (with preset dropdown) into one section.
        <strong>Auto Eat</strong> sits at the bottom with food name input and HP% slider.
        No section title shown in the console tab.
      </div>
    </div>

    <div class="entry improve">
      <div class="entry-tag">Improve</div>
      <div class="entry-title">Charm Counting Snapshot Timing</div>
      <div class="entry-desc">
        Post-loot inventory snapshot delay extended from 600–1200ms to 1200–1800ms so items
        have time to land in the backpack before the pre/post diff runs.
        A debug log line now prints exact before/after charm and coin counts on every loot cycle.
      </div>
    </div>

    <div class="entry improve">
      <div class="entry-tag">Improve</div>
      <div class="entry-title">Aggro Detection Simplified and Debuggable</div>
      <div class="entry-desc">
        Removed unreliable <code>getHitmarks()</code> (only fires the exact damage tick) and the
        broken <code>NpcQuery.interactId(playerId)</code> call (filtered by NPC ID, not target).
        Replaced NPC targeting check with a loop over all nearby NPCs calling <code>npc.getInteractId()</code>
        and comparing to the player ID. Added <code>[AggroDebug]</code> log lines printing
        <code>inCombat</code>, <code>hasTarget</code>, and <code>npcOnUs</code> every ~5 seconds
        so detection issues are immediately visible in the console.
        Walk timeout and arrived paths both reset <code>lastCombatTimeMs</code> to prevent spin-retries.
      </div>
    </div>

  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!--  KNOWN ISSUES                                                            -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <div class="section">
    <div class="section-header"><h2>Known Issues / To Fix</h2></div>

    <div class="known">
      <div class="known-title">Aggro rotation fires on first loop before any combat</div>
      <div class="known-desc">
        <code>lastCombatTimeMs</code> starts at 0, so on the very first loop tick the idle check 
        passes immediately if the grace period math overflows. Guard added (<code>lastCombatTimeMs == 0L</code> 
        skips rotation) but needs testing at a location with no initial aggro to confirm it holds.
      </div>
    </div>

    <div class="known">
      <div class="known-title">Not-retaliating state does not auto-retaliate</div>
      <div class="known-desc">
        When the script detects that an NPC is targeting the player but the player has no target 
        (auto-retaliate may be off or slow), it only logs a warning. It does not attempt to 
        re-engage the NPC. Adding auto-retaliate triggering via NPC interact is a planned improvement.
      </div>
    </div>

    <div class="known">
      <div class="known-title">Overload damage window is a fixed 5s timer, not tick-accurate</div>
      <div class="known-desc">
        The 5-second eat suppression after drinking an overload is hardcoded. If the server is lagging 
        or the pouch takes longer to proc, food could still fire during a damage tick. 
        A better approach would be to watch <code>getHitmarks()</code> and suppress eating while 
        overload self-damage splats are present.
      </div>
    </div>





  </div>


  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <!--  SESSION 2 — FEB 27 2026                                               -->
  <!-- ═══════════════════════════════════════════════════════════════════════ -->
  <div class="section">
    <div class="section-header"><h2>Session 2 — Feb 27, 2026</h2></div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Banking System — Full Taverley Route</div>
      <div class="entry-desc">
        Complete bank-and-return loop for Hellhounds (Taverley Dungeon).
        Triggered when food runs out and <code>useBanking</code> is ON.
        <strong>Out:</strong> climb ladder (OBJECT1 <code>74866</code> at <code>2842,9824</code>) →
        NavPath to Taverley bank surface → <code>Bank.depositAll()</code> →
        click booth OBJECT4 <code>66666</code> (Load Last Preset) → wait for bank open → food check.
        <strong>In:</strong> NavPath to dungeon entrance → click entrance → wait for
        <code>Y ≥ 9700</code> → manual door sequence (door 1 → 2 → 3) →
        NavPath to <code>bankReturnCoord</code>.
        If food missing after preset — emergency logout.
        <code>isBanking</code> flag in <code>try/finally</code> always resets.
        UI shows green <em>"Banking in progress…"</em> / <em>"Returning to dungeon…"</em> status.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Shortcuts Toggle</div>
      <div class="entry-desc">
        <code>useShortcuts</code> checkbox (default OFF). When OFF the return route manually clicks
        each dungeon door in sequence. When ON the pathfinder handles the entire underground route
        using agility shortcuts automatically. UI checkbox added in the right column below Banking.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Startup Dungeon Entry — Banking Mode</div>
      <div class="entry-desc">
        When Banking is ON and START is pressed, <code>needsInitialDungeonPath</code> is set.
        The very first <code>onLoop</code> tick detects this flag and runs <code>returnToDungeon()</code>
        before any AFK logic fires — walking the player from the bank into the dungeon to the
        combat AFK spot. Without this the script would start in AFK mode while standing at the bank.
        Flag is cleared after the walk completes.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Kickstart Combat on Arrival</div>
      <div class="entry-desc">
        After arriving at the combat AFK tile (initial startup or banking return),
        <code>kickstartCombat()</code> finds the nearest Hellhound via
        <code>NpcQuery.newQuery().name("Hellhound")</code> and attacks it immediately.
        Primary path: <code>npc.interact("Attack")</code>.
        Fallback: <code>MiniMenu.interact(NPCAction.NPC1, npcIndex, 0, 0)</code>
        matching the confirmed packet <code>DoAction(N/A, 16909, 0, 0)</code>.
        Retries up to 5× with 0.8–1.4s gaps to handle scene still loading after a map transition.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Auto-Retaliate Toggle on Aggro Reset</div>
      <div class="entry-desc">
        Before walking to the aggro reset coordinate, auto-retaliate is disabled via
        <code>DoAction(COMPONENT, 1, -1, 93716537)</code> (same packet toggles on and off).
        A <code>retaliateDisabled</code> flag and <code>try/finally</code> guarantee re-enable
        fires regardless of whether the walk succeeds or throws. Extra server-tick delay after
        re-enable to confirm registration.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Emergency Logout — No Food (Banking OFF)</div>
      <div class="entry-desc">
        When food runs out and Banking is OFF and <code>useLogoutOnFood</code> is ON:
        sets <code>running = false</code> → climbs ladder (OBJECT1 <code>74866</code>) →
        waits for <code>Y &lt; 9700</code> surface transition →
        opens logout panel (<code>COMPONENT 1 1 96796771</code>) →
        clicks Exit to Lobby (<code>COMPONENT 1 -1 93913157</code>).
        Logout clicks fire even if ladder click fails.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Potion Suppression During Return Walk</div>
      <div class="entry-desc">
        <code>returningFromBank</code> flag (set during all banking return walks) causes both
        <code>handleCharmPotion()</code> and <code>handleOverload()</code> to return immediately.
        Prevents potions being drunk mid-walk through the dungeon before reaching the combat spot.
        Both potion active flags are also reset to <code>false</code> after arrival so they
        re-drink on the very next loop tick.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Gear Tab Idle Check</div>
      <div class="entry-desc">
        Every 10–15 min: drags Equipment tab open → dwells → drags Skills tab →
        hovers the combat skill with the most XP gained this session →
        drags Backpack tab back. Uses <code>Interfaces.dragComponents()</code> on interface
        <code>1477</code> (RS3 customisable toolbar). Confirmed drag slots:
        Equipment <code>117→112</code>, Skills <code>325→320</code>, Backpack <code>106→101</code>.
        Skill component index formula: <code>(Skills.getId() × 2) + 1</code> in interface <code>1221</code>.
        Falls back to Strength if no XP gained yet.
      </div>
    </div>

    <div class="entry feature">
      <div class="entry-tag">Feature</div>
      <div class="entry-title">Camera Rotation — AWT Robot</div>
      <div class="entry-desc">
        Rotates the RS3 camera 45–90° every 2–5 minutes by holding an arrow key via
        <code>java.awt.Robot</code>. Direction alternates left/right with a 25% chance
        of repeating the same side to avoid a mechanical L-R-L-R pattern.
        Hold duration maps to rotation angle: 500ms ≈ 45°, 1000ms ≈ 90°.
        Key is always released in a <code>try/catch(InterruptedException)</code> block.
      </div>
    </div>

    <!-- Session 2 Fixes -->
    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">Banking Loop — Deposit Before Preset Load</div>
      <div class="entry-desc">
        After the bank opened, the preset was applied to a full backpack — leftover combat items
        occupied slots so food could not be withdrawn and the food check failed, triggering another
        banking trip immediately. Fixed by calling <code>Bank.depositAll()</code> before checking
        food, clearing the backpack so the preset fills it cleanly. Post-preset food count is now
        logged to the console for diagnosis.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">Dungeon Entrance Loop — Y-Coordinate Detection</div>
      <div class="entry-desc">
        Step B of <code>returnToDungeon()</code> used <code>z != 0</code> to detect underground
        entry — but Taverley Dungeon is at z=0 just like the surface, so the check never fired.
        The retry loop kept re-navving to the surface entrance coords and clicking the exit ladder
        from inside the dungeon. Fixed: underground detection now checks <code>Y ≥ 9700</code>
        (dungeon tiles confirmed at Y~9795). Added an early-out skip if already underground
        on entry to the method. Same fix applied to the ladder-climb surface transition
        (<code>Y &lt; 9700</code>) in <code>handleBanking()</code> Phase 1 and
        <code>handleEmergencyLogout()</code>.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">Door Sequence — Infinite Retry, No Script Stop</div>
      <div class="entry-desc">
        <code>clickDoorAndWait()</code> previously returned <code>false</code> after two attempts
        and stopped the script. Rewritten as an infinite <code>while (running)</code> loop:
        navs to the door, waits up to 15s for the player to be within 8 tiles (object loaded),
        clicks, waits up to 20s for the passage threshold. Re-checks after an extra 1.5–2.5s
        wait before re-clicking (catches slow load screens where the player passed through during
        the wait). Skips immediately if already past the door's threshold. Return type changed
        from <code>boolean</code> to <code>void</code>.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">Dungeon Entrance — Infinite Retry on Slow Load Screens</div>
      <div class="entry-desc">
        The dungeon entrance click in Step B previously had one retry then stopped the script.
        Replaced with a <code>while (!inside && running)</code> loop that re-navs to the entrance
        and retries the click indefinitely, waiting up to 20s per attempt for <code>Y ≥ 9700</code>.
        Handles cases where the map load screen takes 15–20 seconds.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">ImGui PopStyleColor Count — drawSettingsPanel</div>
      <div class="entry-desc">
        The final <code>PopStyleColor</code> loop count was wrong (16 instead of 14).
        Exact push count for <code>drawSettingsPanel()</code>: 5× CheckMark left column +
        5× CheckMark right column + 4× Food input styling = <strong>14</strong>.
        The banking status / warning text pushes (3×) each self-pop immediately and must not
        be included in the final loop. Over-popping was stealing color state from subsequent
        widgets rendered in the same frame.
      </div>
    </div>

    <div class="entry fix">
      <div class="entry-tag">Fix</div>
      <div class="entry-title">Potion Drink Race — delayUntil Dose Consumed</div>
      <div class="entry-desc">
        All four doses of a Charming potion or Overload were being interacted on the same tick
        before any was consumed. Fixed by calling
        <code>Execution.delayUntil(3000, () → !Backpack.contains(dose))</code>
        after each successful <code>Backpack.interact(dose, "Drink")</code> —
        waits for that specific dose name to leave the backpack before returning,
        confirming the drink registered server-side. Applied to both
        <code>handleCharmPotion()</code> and <code>handleOverload()</code>.
      </div>
    </div>

  </div>

  <div class="footer">
    <span class="pulse"></span>
    CHARM COLLECTOR &nbsp;·&nbsp; SESSION 2 — 2026-02-27 &nbsp;·&nbsp; BOTWITHUS API 1.0.8
  </div>

</div>
</body>
</html>
